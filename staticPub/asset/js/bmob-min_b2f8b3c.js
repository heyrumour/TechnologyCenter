!function(a){a.Bmob=a.Bmob||{},a.Bmob.VERSION="js0.0.1"}(this),function(){var a=this,c=a._,h={},_=Array.prototype,f=Object.prototype,r=Function.prototype,v=_.push,o=_.slice,g=_.concat,d=f.toString,b=f.hasOwnProperty,y=_.forEach,q=_.map,O=_.reduce,w=_.reduceRight,E=_.filter,S=_.every,p=_.some,n=_.indexOf,l=_.lastIndexOf,u=Array.isArray,e=Object.keys,j=r.bind,A=function(a){return a instanceof A?a:this instanceof A?void(this._wrapped=a):new A(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=A),exports._=A):a._=A,A.VERSION="1.4.4";var C=A.each=A.forEach=function(a,c,_){if(null!=a)if(y&&a.forEach===y)a.forEach(c,_);else if(a.length===+a.length){for(var v=0,g=a.length;g>v;v++)if(c.call(_,a[v],v,a)===h)return}else for(var b in a)if(A.has(a,b)&&c.call(_,a[b],b,a)===h)return};A.map=A.collect=function(a,c,h){var _=[];return null==a?_:q&&a.map===q?a.map(c,h):(C(a,function(a,v,g){_[_.length]=c.call(h,a,v,g)}),_)};var R="Reduce of empty array with no initial value";A.reduce=A.foldl=A.inject=function(a,c,h,_){var v=arguments.length>2;if(null==a&&(a=[]),O&&a.reduce===O)return _&&(c=A.bind(c,_)),v?a.reduce(c,h):a.reduce(c);if(C(a,function(a,g,b){v?h=c.call(_,h,a,g,b):(h=a,v=!0)}),!v)throw new TypeError(R);return h},A.reduceRight=A.foldr=function(a,c,h,_){var v=arguments.length>2;if(null==a&&(a=[]),w&&a.reduceRight===w)return _&&(c=A.bind(c,_)),v?a.reduceRight(c,h):a.reduceRight(c);var g=a.length;if(g!==+g){var b=A.keys(a);g=b.length}if(C(a,function(y,O,w){O=b?b[--g]:--g,v?h=c.call(_,h,a[O],O,w):(h=a[O],v=!0)}),!v)throw new TypeError(R);return h},A.find=A.detect=function(a,c,h){var _;return N(a,function(a,v,g){return c.call(h,a,v,g)?(_=a,!0):void 0}),_},A.filter=A.select=function(a,c,h){var _=[];return null==a?_:E&&a.filter===E?a.filter(c,h):(C(a,function(a,v,g){c.call(h,a,v,g)&&(_[_.length]=a)}),_)},A.reject=function(a,c,h){return A.filter(a,function(a,_,v){return!c.call(h,a,_,v)},h)},A.every=A.all=function(a,c,_){c||(c=A.identity);var v=!0;return null==a?v:S&&a.every===S?a.every(c,_):(C(a,function(a,g,b){return(v=v&&c.call(_,a,g,b))?void 0:h}),!!v)};var N=A.some=A.any=function(a,c,_){c||(c=A.identity);var v=!1;return null==a?v:p&&a.some===p?a.some(c,_):(C(a,function(a,g,b){return v||(v=c.call(_,a,g,b))?h:void 0}),!!v)};A.contains=A.include=function(a,c){return null==a?!1:n&&a.indexOf===n?-1!=a.indexOf(c):N(a,function(a){return a===c})},A.invoke=function(a,c){var h=o.call(arguments,2),_=A.isFunction(c);return A.map(a,function(a){return(_?c:a[c]).apply(a,h)})},A.pluck=function(a,c){return A.map(a,function(a){return a[c]})},A.where=function(a,c,h){return A.isEmpty(c)?h?null:[]:A[h?"find":"filter"](a,function(a){for(var h in c)if(c[h]!==a[h])return!1;return!0})},A.findWhere=function(a,c){return A.where(a,c,!0)},A.max=function(a,c,h){if(!c&&A.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!c&&A.isEmpty(a))return-1/0;var _={computed:-1/0,value:-1/0};return C(a,function(a,v,g){var b=c?c.call(h,a,v,g):a;b>=_.computed&&(_={value:a,computed:b})}),_.value},A.min=function(a,c,h){if(!c&&A.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!c&&A.isEmpty(a))return 1/0;var _={computed:1/0,value:1/0};return C(a,function(a,v,g){var b=c?c.call(h,a,v,g):a;b<_.computed&&(_={value:a,computed:b})}),_.value},A.shuffle=function(a){var c,h=0,_=[];return C(a,function(a){c=A.random(h++),_[h-1]=_[c],_[c]=a}),_};var U=function(a){return A.isFunction(a)?a:function(c){return c[a]}};A.sortBy=function(a,c,h){var _=U(c);return A.pluck(A.map(a,function(a,c,v){return{value:a,index:c,criteria:_.call(h,a,c,v)}}).sort(function(a,c){var h=a.criteria,_=c.criteria;if(h!==_){if(h>_||void 0===h)return 1;if(_>h||void 0===_)return-1}return a.index<c.index?-1:1}),"value")};var t=function(a,c,h,_){var v={},g=U(c||A.identity);return C(a,function(c,b){var y=g.call(h,c,b,a);_(v,y,c)}),v};A.groupBy=function(a,c,h){return t(a,c,h,function(a,c,h){(A.has(a,c)?a[c]:a[c]=[]).push(h)})},A.countBy=function(a,c,h){return t(a,c,h,function(a,c){A.has(a,c)||(a[c]=0),a[c]++})},A.sortedIndex=function(a,c,h,_){h=null==h?A.identity:U(h);for(var v=h.call(_,c),g=0,b=a.length;b>g;){var y=g+b>>>1;h.call(_,a[y])<v?g=y+1:b=y}return g},A.toArray=function(a){return a?A.isArray(a)?o.call(a):a.length===+a.length?A.map(a,A.identity):A.values(a):[]},A.size=function(a){return null==a?0:a.length===+a.length?a.length:A.keys(a).length},A.first=A.head=A.take=function(a,c,h){return null==a?void 0:null==c||h?a[0]:o.call(a,0,c)},A.initial=function(a,c,h){return o.call(a,0,a.length-(null==c||h?1:c))},A.last=function(a,c,h){return null==a?void 0:null==c||h?a[a.length-1]:o.call(a,Math.max(a.length-c,0))},A.rest=A.tail=A.drop=function(a,c,h){return o.call(a,null==c||h?1:c)},A.compact=function(a){return A.filter(a,A.identity)};var x=function(a,c,h){return C(a,function(a){A.isArray(a)?c?v.apply(h,a):x(a,c,h):h.push(a)}),h};A.flatten=function(a,c){return x(a,c,[])},A.without=function(a){return A.difference(a,o.call(arguments,1))},A.uniq=A.unique=function(a,c,h,_){A.isFunction(c)&&(_=h,h=c,c=!1);var v=h?A.map(a,h,_):a,g=[],b=[];return C(v,function(h,_){(c?_&&b[b.length-1]===h:A.contains(b,h))||(b.push(h),g.push(a[_]))}),g},A.union=function(){return A.uniq(g.apply(_,arguments))},A.intersection=function(a){var c=o.call(arguments,1);return A.filter(A.uniq(a),function(a){return A.every(c,function(c){return A.indexOf(c,a)>=0})})},A.difference=function(a){var c=g.apply(_,o.call(arguments,1));return A.filter(a,function(a){return!A.contains(c,a)})},A.zip=function(){for(var a=o.call(arguments),c=A.max(A.pluck(a,"length")),h=new Array(c),_=0;c>_;_++)h[_]=A.pluck(a,""+_);return h},A.object=function(a,c){if(null==a)return{};for(var h={},_=0,v=a.length;v>_;_++)c?h[a[_]]=c[_]:h[a[_][0]]=a[_][1];return h},A.indexOf=function(a,c,h){if(null==a)return-1;var _=0,v=a.length;if(h){if("number"!=typeof h)return _=A.sortedIndex(a,c),a[_]===c?_:-1;_=0>h?Math.max(0,v+h):h}if(n&&a.indexOf===n)return a.indexOf(c,h);for(;v>_;_++)if(a[_]===c)return _;return-1},A.lastIndexOf=function(a,c,h){if(null==a)return-1;var _=null!=h;if(l&&a.lastIndexOf===l)return _?a.lastIndexOf(c,h):a.lastIndexOf(c);for(var v=_?h:a.length;v--;)if(a[v]===c)return v;return-1},A.range=function(a,c,h){arguments.length<=1&&(c=a||0,a=0),h=arguments[2]||1;for(var _=Math.max(Math.ceil((c-a)/h),0),v=0,g=new Array(_);_>v;)g[v++]=a,a+=h;return g},A.bind=function(a,c){if(a.bind===j&&j)return j.apply(a,o.call(arguments,1));var h=o.call(arguments,2);return function(){return a.apply(c,h.concat(o.call(arguments)))}},A.partial=function(a){var c=o.call(arguments,1);return function(){return a.apply(this,c.concat(o.call(arguments)))}},A.bindAll=function(a){var c=o.call(arguments,1);return 0===c.length&&(c=A.functions(a)),C(c,function(c){a[c]=A.bind(a[c],a)}),a},A.memoize=function(a,c){var h={};return c||(c=A.identity),function(){var _=c.apply(this,arguments);return A.has(h,_)?h[_]:h[_]=a.apply(this,arguments)}},A.delay=function(a,c){var h=o.call(arguments,2);return setTimeout(function(){return a.apply(null,h)},c)},A.defer=function(a){return A.delay.apply(A,[a,1].concat(o.call(arguments,1)))},A.throttle=function(a,c){var h,_,v,g,b=0,y=function(){b=new Date,v=null,g=a.apply(h,_)};return function(){var O=new Date,w=c-(O-b);return h=this,_=arguments,0>=w?(clearTimeout(v),v=null,b=O,g=a.apply(h,_)):v||(v=setTimeout(y,w)),g}},A.debounce=function(a,c,h){var _,v;return function(){var g=this,b=arguments,y=function(){_=null,h||(v=a.apply(g,b))},O=h&&!_;return clearTimeout(_),_=setTimeout(y,c),O&&(v=a.apply(g,b)),v}},A.once=function(a){var c,h=!1;return function(){return h?c:(h=!0,c=a.apply(this,arguments),a=null,c)}},A.wrap=function(a,c){return function(){var h=[a];return v.apply(h,arguments),c.apply(this,h)}},A.compose=function(){var a=arguments;return function(){for(var c=arguments,h=a.length-1;h>=0;h--)c=[a[h].apply(this,c)];return c[0]}},A.after=function(a,c){return 0>=a?c():function(){return--a<1?c.apply(this,arguments):void 0}},A.keys=e||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[];for(var h in a)A.has(a,h)&&(c[c.length]=h);return c},A.values=function(a){var c=[];for(var h in a)A.has(a,h)&&c.push(a[h]);return c},A.pairs=function(a){var c=[];for(var h in a)A.has(a,h)&&c.push([h,a[h]]);return c},A.invert=function(a){var c={};for(var h in a)A.has(a,h)&&(c[a[h]]=h);return c},A.functions=A.methods=function(a){var c=[];for(var h in a)A.isFunction(a[h])&&c.push(h);return c.sort()},A.extend=function(a){return C(o.call(arguments,1),function(c){if(c)for(var h in c)a[h]=c[h]}),a},A.pick=function(a){var c={},h=g.apply(_,o.call(arguments,1));return C(h,function(h){h in a&&(c[h]=a[h])}),c},A.omit=function(a){var c={},h=g.apply(_,o.call(arguments,1));for(var v in a)A.contains(h,v)||(c[v]=a[v]);return c},A.defaults=function(a){return C(o.call(arguments,1),function(c){if(c)for(var h in c)null==a[h]&&(a[h]=c[h])}),a},A.clone=function(a){return A.isObject(a)?A.isArray(a)?a.slice():A.extend({},a):a},A.tap=function(a,c){return c(a),a};var I=function(a,c,h,_){if(a===c)return 0!==a||1/a==1/c;if(null==a||null==c)return a===c;a instanceof A&&(a=a._wrapped),c instanceof A&&(c=c._wrapped);var v=d.call(a);if(v!=d.call(c))return!1;switch(v){case"[object String]":return a==String(c);case"[object Number]":return a!=+a?c!=+c:0==a?1/a==1/c:a==+c;case"[object Date]":case"[object Boolean]":return+a==+c;case"[object RegExp]":return a.source==c.source&&a.global==c.global&&a.multiline==c.multiline&&a.ignoreCase==c.ignoreCase}if("object"!=typeof a||"object"!=typeof c)return!1;for(var g=h.length;g--;)if(h[g]==a)return _[g]==c;h.push(a),_.push(c);var b=0,y=!0;if("[object Array]"==v){if(b=a.length,y=b==c.length)for(;b--&&(y=I(a[b],c[b],h,_)););}else{var O=a.constructor,w=c.constructor;if(O!==w&&!(A.isFunction(O)&&O instanceof O&&A.isFunction(w)&&w instanceof w))return!1;for(var E in a)if(A.has(a,E)&&(b++,!(y=A.has(c,E)&&I(a[E],c[E],h,_))))break;if(y){for(E in c)if(A.has(c,E)&&!b--)break;y=!b}}return h.pop(),_.pop(),y};A.isEqual=function(a,c){return I(a,c,[],[])},A.isEmpty=function(a){if(null==a)return!0;if(A.isArray(a)||A.isString(a))return 0===a.length;for(var c in a)if(A.has(a,c))return!1;return!0},A.isElement=function(a){return!(!a||1!==a.nodeType)},A.isArray=u||function(a){return"[object Array]"==d.call(a)},A.isObject=function(a){return a===Object(a)},C(["Arguments","Function","String","Number","Date","RegExp"],function(a){A["is"+a]=function(c){return d.call(c)=="[object "+a+"]"}}),A.isArguments(arguments)||(A.isArguments=function(a){return!(!a||!A.has(a,"callee"))}),"function"!=typeof/./&&(A.isFunction=function(a){return"function"==typeof a}),A.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},A.isNaN=function(a){return A.isNumber(a)&&a!=+a},A.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==d.call(a)},A.isNull=function(a){return null===a},A.isUndefined=function(a){return void 0===a},A.has=function(a,c){return b.call(a,c)},A.noConflict=function(){return a._=c,this},A.identity=function(a){return a},A.times=function(a,c,h){for(var _=Array(a),v=0;a>v;v++)_[v]=c.call(h,v);return _},A.random=function(a,c){return null==c&&(c=a,a=0),a+Math.floor(Math.random()*(c-a+1))};var m={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};m.unescape=A.invert(m.escape);var P={escape:new RegExp("["+A.keys(m.escape).join("")+"]","g"),unescape:new RegExp("("+A.keys(m.unescape).join("|")+")","g")};A.each(["escape","unescape"],function(a){A[a]=function(c){return null==c?"":(""+c).replace(P[a],function(c){return m[a][c]})}}),A.result=function(a,c){if(null==a)return null;var h=a[c];return A.isFunction(h)?h.call(a):h},A.mixin=function(a){C(A.functions(a),function(c){var h=A[c]=a[c];A.prototype[c]=function(){var a=[this._wrapped];return v.apply(a,arguments),s.call(this,h.apply(A,a))}})};var T=0;A.uniqueId=function(a){var c=++T+"";return a?a+c:c},A.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var k=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},i=/\\|'|\r|\n|\t|\u2028|\u2029/g;A.template=function(a,c,h){var _;h=A.defaults({},h,A.templateSettings);var v=new RegExp([(h.escape||k).source,(h.interpolate||k).source,(h.evaluate||k).source].join("|")+"|$","g"),g=0,b="__p+='";a.replace(v,function(c,h,_,v,y){return b+=a.slice(g,y).replace(i,function(a){return"\\"+B[a]}),h&&(b+="'+\n((__t=("+h+"))==null?'':_.escape(__t))+\n'"),_&&(b+="'+\n((__t=("+_+"))==null?'':__t)+\n'"),v&&(b+="';\n"+v+"\n__p+='"),g=y+c.length,c}),b+="';\n",h.variable||(b="with(obj||{}){\n"+b+"}\n"),b="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+b+"return __p;\n";try{_=new Function(h.variable||"obj","_",b)}catch(y){throw y.source=b,y}if(c)return _(c,A);var O=function(a){return _.call(this,a,A)};return O.source="function("+(h.variable||"obj")+"){\n"+b+"}",O},A.chain=function(a){return A(a).chain()};var s=function(a){return this._chain?A(a).chain():a};A.mixin(A),C(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var c=_[a];A.prototype[a]=function(){var h=this._wrapped;return c.apply(h,arguments),"shift"!=a&&"splice"!=a||0!==h.length||delete h[0],s.call(this,h)}}),C(["concat","join","slice"],function(a){var c=_[a];A.prototype[a]=function(){return s.call(this,c.apply(this._wrapped,arguments))}}),A.extend(A.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(a){a.Bmob=a.Bmob||{};var d=a.Bmob;if("undefined"!=typeof exports&&exports._){d._=exports._.noConflict();try{d.localStorage=require("localStorage")}catch(c){d.localStorage=require("./localStorage.js").localStorage}d.XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,exports.Bmob=d}else d._=_.noConflict(),"undefined"!=typeof localStorage&&(d.localStorage=localStorage),"undefined"!=typeof XMLHttpRequest&&(d.XMLHttpRequest=XMLHttpRequest);"undefined"!=typeof $&&(d.$=$);var h=function(){},e=function(a,f,c){var i;return i=f&&f.hasOwnProperty("constructor")?f.constructor:function(){a.apply(this,arguments)},d._.extend(i,a),h.prototype=a.prototype,i.prototype=new h,f&&d._.extend(i.prototype,f),c&&d._.extend(i,c),i.prototype.constructor=i,i.__super__=a.prototype,i};d.serverURL="https://api.bmob.cn",d.fileURL="http://file.bmob.cn","undefined"!=typeof process&&process.versions&&process.versions.node&&(d._isNode=!0),d.initialize=function(a,c,f){d._initialize(a,c,f)},d._initialize=function(a,c,f){d.applicationId=a,d.applicationKey=c,d.masterKey=f,d._useMasterKey=!0},d._isNode&&(d.initialize=d._initialize),d._getBmobPath=function(f){if(!d.applicationId)throw"You need to call Bmob.initialize before using Bmob.";if(f||(f=""),!d._.isString(f))throw"Tried to get a localStorage path that wasn't a String.";return"/"===f[0]&&(f=f.substring(1)),"Bmob/"+d.applicationId+"/"+f},d._installationId=null,d._getInstallationId=function(){if(d._installationId)return d._installationId;var a=d._getBmobPath("installationId");if(d._installationId=d.localStorage.getItem(a),!d._installationId||""===d._installationId){var f=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};d._installationId=f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f(),d.localStorage.setItem(a,d._installationId)}return d._installationId},d._parseDate=function(o){var l=new RegExp("^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$"),a=l.exec(o);if(!a)return null;var m=a[1]||0,c=(a[2]||1)-1,n=a[3]||0,h=a[4]||0,_=a[5]||0,f=a[6]||0,i=a[8]||0;return new Date(Date.UTC(m,c,n,h,_,f,i))},d._ajaxIE8=function(a,c,h){var i=new d.Promise,f=new XDomainRequest;return f.onload=function(){var a;try{a=JSON.parse(f.responseText)}catch(l){i.reject(l)}a&&i.resolve(a)},f.onerror=f.ontimeout=function(){i.reject(f)},f.onprogress=function(){},f.open(a,c),f.send(h),i},d._ajax=function(f,a,c,h,_){var n={success:h,error:_};if("undefined"!=typeof XDomainRequest)return d._ajaxIE8(f,a,c)._thenRunCallbacks(n);var m=new d.Promise,i=!1,l=new d.XMLHttpRequest;return l.onreadystatechange=function(){if(4===l.readyState){if(i)return;i=!0;var p;try{p=JSON.parse(l.responseText)}catch(q){}if(200==l.status&&p&&p.code&&p.error)l.status=400,m.reject(l);else if(l.status>=200&&l.status<300){var o;try{o=JSON.parse(l.responseText)}catch(q){m.reject(q)}o&&m.resolve(o,l.status,l)}}},l.open(f,a,!0),l.setRequestHeader("Content-Type","text/plain"),d._isNode&&l.setRequestHeader("User-Agent","Bmob/"+d.VERSION+" (NodeJS "+process.versions.node+")"),l.send(c),m._thenRunCallbacks(n)},d._extend=function(f,a){var c=e(this,f,a);return c.extend=this.extend,c},d._request=function(a,c,h,m,_){if(!d.applicationId)throw"You must specify your applicationId using Bmob.initialize";if(!d.applicationKey&&!d.masterKey)throw"You must specify a key using Bmob.initialize";var i=d.serverURL;"/"!==i.charAt(i.length-1)&&(i+="/"),i+=a.indexOf("2/")<0?"1/"+a:a,c&&(i+="/"+c),h&&(i+="/"+h),"users"!==a&&"classes"!==a||"PUT"!==m||!_._fetchWhenSave||(delete _._fetchWhenSave,i+="?new=true"),_=d._.clone(_||{}),"POST"!==m&&(_._Method=m,m="POST"),_._ApplicationId=d.applicationId,_._RestKey=d.applicationKey,d._useMasterKey&&void 0!=d.masterKey&&(_._MasterKey=d.masterKey),_._ClientVersion=d.VERSION,_._InstallationId=d._getInstallationId();var f=d.User.current();f&&f._sessionToken&&(_._SessionToken=f._sessionToken);var l=JSON.stringify(_);return d._ajax(m,i,l).then(null,function(n){var p;if(n&&n.responseText)try{var o=JSON.parse(n.responseText);o&&(p=new d.Error(o.code,o.error))}catch(q){}return p=p||new d.Error(-1,n.responseText),d.Promise.error(p)})},d._getValue=function(f,a){return f&&f[a]?d._.isFunction(f[a])?f[a]():f[a]:null},d._encode=function(a,i,c){var h=d._;if(a instanceof d.Object){if(c)throw"Bmob.Objects not allowed here";if(!i||h.include(i,a)||!a._hasData)return a._toPointer();if(!a.dirty())return i=i.concat(a),d._encode(a._toFullJSON(i),i,c);throw"Tried to save an object with a pointer to a new, unsaved object."}if(a instanceof d.ACL)return a.toJSON();if(h.isDate(a))return{__type:"Date",iso:a.toJSON()};if(a instanceof d.GeoPoint)return a.toJSON();if(h.isArray(a))return h.map(a,function(a){return d._encode(a,i,c)});if(h.isRegExp(a))return a.source;if(a instanceof d.Relation)return a.toJSON();if(a instanceof d.Op)return a.toJSON();if(a instanceof d.File){if(!a.url())throw"Tried to save an object containing an unsaved file.";return{__type:"File",cdn:a.cdn(),filename:a.name(),url:a.url()}}if(h.isObject(a)){var f={};return d._objectEach(a,function(m,l){f[l]=d._encode(m,i,c)}),f}return a},d._decode=function(i,l){var a=d._;if(!a.isObject(l))return l;if(a.isArray(l))return d._arrayEach(l,function(o,n){l[n]=d._decode(n,o)}),l;if(l instanceof d.Object)return l;if(l instanceof d.File)return l;if(l instanceof d.Op)return l;if(l.__op)return d.Op._decode(l);if("Pointer"===l.__type){var c=l.className,m=d.Object._create(c);return l.createdAt?(delete l.__type,delete l.className,m._finishFetch(l,!0)):m._finishFetch({objectId:l.objectId},!1),m}if("Object"===l.__type){var c=l.className;delete l.__type,delete l.className;var f=d.Object._create(c);return f._finishFetch(l,!0),f}if("Date"===l.__type)return l.iso;if("GeoPoint"===l.__type)return new d.GeoPoint({latitude:l.latitude,longitude:l.longitude});if("ACL"===i)return l instanceof d.ACL?l:new d.ACL(l);if("Relation"===l.__type){var h=new d.Relation(null,i);return h.targetClassName=l.className,h}if("File"===l.__type){if(void 0!=l.url&&null!=l.url)if(l.url.indexOf("http")>=0)var _={_name:l.filename,_url:l.url,_group:l.group};else var _={_name:l.filename,_url:d.fileURL+"/"+l.url,_group:l.group};else var _={_name:l.filename,_url:l.url,_group:l.group};return _}return d._objectEach(l,function(o,n){l[n]=d._decode(n,o)}),l},d._arrayEach=d._.each,d._traverse=function(a,c,f){if(a instanceof d.Object){if(f=f||[],d._.indexOf(f,a)>=0)return;return f.push(a),d._traverse(a.attributes,c,f),c(a)}return a instanceof d.Relation||a instanceof d.File?c(a):d._.isArray(a)?(d._.each(a,function(h,_){var i=d._traverse(h,c,f);i&&(a[_]=i)}),c(a)):d._.isObject(a)?(d._each(a,function(h,_){var i=d._traverse(h,c,f);i&&(a[_]=i)}),c(a)):c(a)},d._objectEach=d._each=function(a,c){var f=d._;f.isObject(a)?f.each(f.keys(a),function(i){c(a[i],i)}):f.each(a,c)},d._isNullOrUndefined=function(f){return d._.isNull(f)||d._.isUndefined(f)}}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.Error=function(e,d){this.code=e,this.message=d},h.extend(c.Error,{OTHER_CAUSE:-1,OBJECT_NOT_FOUND:101,INVALID_QUERY:102,INVALID_CLASS_NAME:103,RELATIONDOCNOTEXISTS:104,INVALID_KEY_NAME:105,INVALID_POINTER:106,INVALID_JSON:107,USERNAME_PASSWORD_REQUIRED:108,INCORRECT_TYPE:111,REQUEST_MUST_ARRAY:112,REQUEST_MUST_OBJECT:113,OBJECT_TOO_LARGE:114,GEO_ERROR:117,EMAIL_VERIFY_MUST_OPEN:120,CACHE_MISS:120,INVALID_DEVICE_TOKEN:131,INVALID_INSTALLID:132,INVALID_DEVICE_TYPE:133,DEVICE_TOKEN_EXIST:134,INSTALLID_EXIST:135,DEVICE_TOKEN_NOT_FOR_ANDROID:136,INVALID_INSTALL_OPERATE:137,READ_ONLY:138,INVALID_ROLE_NAME:139,MISS_PUSH_DATA:141,INVALID_PUSH_TIME:142,INVALID_PUSH_EXPIRE:143,PUSH_TIME_MUST_BEFORE_NOW:144,FILE_SIZE_ERROR:145,FILE_NAME_ERROR:146,FILE_NAME_ERROR:147,FILE_LEN_ERROR:148,FILE_UPLOAD_ERROR:150,FILE_DELETE_ERROR:151,IMAGE_ERROR:160,IMAGE_MODE_ERROR:161,IMAGE_WIDTH_ERROR:162,IMAGE_HEIGHT_ERROR:163,IMAGE_LONGEDGE_ERROR:164,IMAGE_SHORTEDGE_ERROR:165,USER_MISSING:201,USER_NAME_TOKEN:202,EMAIL_EXIST:203,NO_EMAIL:204,NOT_FOUND_EMAIL:205,SESSIONTOKEN_ERROR:206,VALID_ERROR:301})}(this),function(){var a=this,c=a.Bmob||(a.Bmob={}),h=/\s+/,d=Array.prototype.slice;c.Events={on:function(a,l,c){var f,_,i,e,v;if(!l)return this;for(a=a.split(h),f=this._callbacks||(this._callbacks={}),_=a.shift();_;)v=f[_],i=v?v.tail:{},i.next=e={},i.context=c,i.callback=l,f[_]={tail:e,next:v?v.next:i},_=a.shift();return this},off:function(l,a,f){var e,m,c,i,v,g;if(m=this._callbacks){if(!(l||a||f))return delete this._callbacks,this;for(l=l?l.split(h):_.keys(m),e=l.shift();e;)if(c=m[e],delete m[e],c&&(a||f)){for(i=c.tail,c=c.next;c!==i;)v=c.callback,g=c.context,(a&&v!==a||f&&g!==f)&&this.on(e,v,g),c=c.next;e=l.shift()}return this}},trigger:function(a){var l,c,_,f,e,v,i;if(!(_=this._callbacks))return this;for(v=_.all,a=a.split(h),i=d.call(arguments,1),l=a.shift();l;){if(c=_[l])for(f=c.tail;(c=c.next)!==f;)c.callback.apply(c.context||this,i);if(c=v)for(f=c.tail,e=[l].concat(i);(c=c.next)!==f;)c.callback.apply(c.context||this,e);l=a.shift()}return this}},c.Events.bind=c.Events.on,c.Events.unbind=c.Events.off}.call(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.GeoPoint=function(f,e){h.isArray(f)?(c.GeoPoint._validate(f[0],f[1]),this.latitude=f[0],this.longitude=f[1]):h.isObject(f)?(c.GeoPoint._validate(f.latitude,f.longitude),this.latitude=f.latitude,this.longitude=f.longitude):h.isNumber(f)&&h.isNumber(e)?(c.GeoPoint._validate(f,e),this.latitude=f,this.longitude=e):(this.latitude=0,this.longitude=0);var d=this;this.__defineGetter__&&this.__defineSetter__&&(this._latitude=this.latitude,this._longitude=this.longitude,this.__defineGetter__("latitude",function(){return d._latitude}),this.__defineGetter__("longitude",function(){return d._longitude}),this.__defineSetter__("latitude",function(a){c.GeoPoint._validate(a,d.longitude),d._latitude=a}),this.__defineSetter__("longitude",function(a){c.GeoPoint._validate(d.latitude,a),d._longitude=a}))},c.GeoPoint._validate=function(e,d){if(-90>e)throw"Bmob.GeoPoint latitude "+e+" < -90.0.";if(e>90)throw"Bmob.GeoPoint latitude "+e+" > 90.0.";if(-180>d)throw"Bmob.GeoPoint longitude "+d+" < -180.0.";if(d>180)throw"Bmob.GeoPoint longitude "+d+" > 180.0."},c.GeoPoint.current=function(d){var e=new c.Promise;return navigator.geolocation.getCurrentPosition(function(f){e.resolve(new c.GeoPoint({latitude:f.coords.latitude,longitude:f.coords.longitude}))},function(f){e.reject(f)}),e._thenRunCallbacks(d)},c.GeoPoint.prototype={toJSON:function(){return c.GeoPoint._validate(this.latitude,this.longitude),{__type:"GeoPoint",latitude:this.latitude,longitude:this.longitude}},radiansTo:function(n){var a=Math.PI/180,d=this.latitude*a,c=this.longitude*a,m=n.latitude*a,h=n.longitude*a,f=d-m,i=c-h,e=Math.sin(f/2),_=Math.sin(i/2),l=e*e+Math.cos(d)*Math.cos(m)*_*_;return l=Math.min(1,l),2*Math.asin(Math.sqrt(l))},kilometersTo:function(d){return 6371*this.radiansTo(d)},milesTo:function(d){return 3958.8*this.radiansTo(d)}}}(this),function(a){a.Bmob=a.Bmob||{};var d=a.Bmob,c=d._,h="*";d.ACL=function(f){var e=this;if(e.permissionsById={},c.isObject(f))if(f instanceof d.User)e.setReadAccess(f,!0),e.setWriteAccess(f,!0);else{if(c.isFunction(f))throw"Bmob.ACL() called with a function.  Did you forget ()?";d._objectEach(f,function(a,h){if(!c.isString(h))throw"Tried to create an ACL with an invalid userId.";e.permissionsById[h]={},d._objectEach(a,function(a,i){if("read"!==i&&"write"!==i)throw"Tried to create an ACL with an invalid permission type.";if(!c.isBoolean(a))throw"Tried to create an ACL with an invalid permission value.";e.permissionsById[h][i]=a})})}},d.ACL.prototype.toJSON=function(){return c.clone(this.permissionsById)},d.ACL.prototype._setAccess=function(e,f,a){if(f instanceof d.User?f=f.id:f instanceof d.Role&&(f="role:"+f.getName()),!c.isString(f))throw"userId must be a string.";if(!c.isBoolean(a))throw"allowed must be either true or false.";var h=this.permissionsById[f];if(!h){if(!a)return;h={},this.permissionsById[f]=h}a?this.permissionsById[f][e]=!0:(delete h[e],c.isEmpty(h)&&delete h[f])},d.ACL.prototype._getAccess=function(e,f){f instanceof d.User?f=f.id:f instanceof d.Role&&(f="role:"+f.getName());var a=this.permissionsById[f];return a&&a[e]?!0:!1},d.ACL.prototype.setReadAccess=function(e,f){this._setAccess("read",e,f)},d.ACL.prototype.getReadAccess=function(e){return this._getAccess("read",e)},d.ACL.prototype.setWriteAccess=function(e,f){this._setAccess("write",e,f)},d.ACL.prototype.getWriteAccess=function(e){return this._getAccess("write",e)},d.ACL.prototype.setPublicReadAccess=function(e){this.setReadAccess(h,e)},d.ACL.prototype.getPublicReadAccess=function(){return this.getReadAccess(h)},d.ACL.prototype.setPublicWriteAccess=function(e){this.setWriteAccess(h,e)},d.ACL.prototype.getPublicWriteAccess=function(){return this.getWriteAccess(h)},d.ACL.prototype.getRoleReadAccess=function(e){if(e instanceof d.Role&&(e=e.getName()),c.isString(e))return this.getReadAccess("role:"+e);throw"role must be a Bmob.Role or a String"},d.ACL.prototype.getRoleWriteAccess=function(e){if(e instanceof d.Role&&(e=e.getName()),c.isString(e))return this.getWriteAccess("role:"+e);throw"role must be a Bmob.Role or a String"},d.ACL.prototype.setRoleReadAccess=function(f,e){if(f instanceof d.Role&&(f=f.getName()),c.isString(f))return void this.setReadAccess("role:"+f,e);throw"role must be a Bmob.Role or a String"},d.ACL.prototype.setRoleWriteAccess=function(f,e){if(f instanceof d.Role&&(f=f.getName()),c.isString(f))return void this.setWriteAccess("role:"+f,e);throw"role must be a Bmob.Role or a String"}}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.Op=function(){this._initialize.apply(this,arguments)},c.Op.prototype={_initialize:function(){}},h.extend(c.Op,{_extend:c._extend,_opDecoderMap:{},_registerDecoder:function(d,e){c.Op._opDecoderMap[d]=e},_decode:function(d){var e=c.Op._opDecoderMap[d.__op];return e?e(d):void 0}}),c.Op._registerDecoder("Batch",function(d){var e=null;return c._arrayEach(d.ops,function(f){f=c.Op._decode(f),e=f._mergeWithPrevious(e)}),e}),c.Op.Set=c.Op._extend({_initialize:function(d){this._value=d},value:function(){return this._value},toJSON:function(){return c._encode(this.value())},_mergeWithPrevious:function(){return this},_estimate:function(){return this.value()}}),c.Op._UNSET={},c.Op.Unset=c.Op._extend({toJSON:function(){return{__op:"Delete"}},_mergeWithPrevious:function(){return this},_estimate:function(){return c.Op._UNSET}}),c.Op._registerDecoder("Delete",function(){return new c.Op.Unset}),c.Op.Increment=c.Op._extend({_initialize:function(d){this._amount=d},amount:function(){return this._amount},toJSON:function(){return{__op:"Increment",amount:this._amount}},_mergeWithPrevious:function(d){if(d){if(d instanceof c.Op.Unset)return new c.Op.Set(this.amount());if(d instanceof c.Op.Set)return new c.Op.Set(d.value()+this.amount());if(d instanceof c.Op.Increment)return new c.Op.Increment(this.amount()+d.amount());throw"Op is invalid after previous op."}return this},_estimate:function(d){return d?d+this.amount():this.amount()}}),c.Op._registerDecoder("Increment",function(d){return new c.Op.Increment(d.amount)}),c.Op.Add=c.Op._extend({_initialize:function(d){this._objects=d},objects:function(){return this._objects},toJSON:function(){return{__op:"Add",objects:c._encode(this.objects())}},_mergeWithPrevious:function(d){if(d){if(d instanceof c.Op.Unset)return new c.Op.Set(this.objects());if(d instanceof c.Op.Set)return new c.Op.Set(this._estimate(d.value()));if(d instanceof c.Op.Add)return new c.Op.Add(d.objects().concat(this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(d){return d?d.concat(this.objects()):h.clone(this.objects())}}),c.Op._registerDecoder("Add",function(d){return new c.Op.Add(c._decode(void 0,d.objects))}),c.Op.AddUnique=c.Op._extend({_initialize:function(d){this._objects=h.uniq(d)},objects:function(){return this._objects},toJSON:function(){return{__op:"AddUnique",objects:c._encode(this.objects())}},_mergeWithPrevious:function(d){if(d){if(d instanceof c.Op.Unset)return new c.Op.Set(this.objects());if(d instanceof c.Op.Set)return new c.Op.Set(this._estimate(d.value()));if(d instanceof c.Op.AddUnique)return new c.Op.AddUnique(this._estimate(d.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(d){if(d){var e=h.clone(d);return c._arrayEach(this.objects(),function(a){if(a instanceof c.Object&&a.id){var _=h.find(e,function(i){return i instanceof c.Object&&i.id===a.id});if(_){var f=h.indexOf(e,_);e[f]=a}else e.push(a)}else h.contains(e,a)||e.push(a)}),e}return h.clone(this.objects())}}),c.Op._registerDecoder("AddUnique",function(d){return new c.Op.AddUnique(c._decode(void 0,d.objects))}),c.Op.Remove=c.Op._extend({_initialize:function(d){this._objects=h.uniq(d)},objects:function(){return this._objects},toJSON:function(){return{__op:"Remove",objects:c._encode(this.objects())}},_mergeWithPrevious:function(d){if(d){if(d instanceof c.Op.Unset)return d;if(d instanceof c.Op.Set)return new c.Op.Set(this._estimate(d.value()));if(d instanceof c.Op.Remove)return new c.Op.Remove(h.union(d.objects(),this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(d){if(d){var e=h.difference(d,this.objects());return c._arrayEach(this.objects(),function(f){f instanceof c.Object&&f.id&&(e=h.reject(e,function(a){return a instanceof c.Object&&a.id===f.id}))}),e}return[]}}),c.Op._registerDecoder("Remove",function(d){return new c.Op.Remove(c._decode(void 0,d.objects))}),c.Op.Relation=c.Op._extend({_initialize:function(a,e){this._targetClassName=null;var d=this,f=function(a){if(a instanceof c.Object){if(!a.id)throw"You can't add an unsaved Bmob.Object to a relation.";if(d._targetClassName||(d._targetClassName=a.className),d._targetClassName!==a.className)throw"Tried to create a Bmob.Relation with 2 different types: "+d._targetClassName+" and "+a.className+".";return a.id}return a};this.relationsToAdd=h.uniq(h.map(a,f)),this.relationsToRemove=h.uniq(h.map(e,f))},added:function(){var d=this;return h.map(this.relationsToAdd,function(e){var f=c.Object._create(d._targetClassName);return f.id=e,f})},removed:function(){var d=this;return h.map(this.relationsToRemove,function(e){var f=c.Object._create(d._targetClassName);return f.id=e,f})},toJSON:function(){var a=null,f=null,e=this,c=function(i){return{__type:"Pointer",className:e._targetClassName,objectId:i}},d=null;return this.relationsToAdd.length>0&&(d=h.map(this.relationsToAdd,c),a={__op:"AddRelation",objects:d}),this.relationsToRemove.length>0&&(d=h.map(this.relationsToRemove,c),f={__op:"RemoveRelation",objects:d}),a&&f?{__op:"Batch",ops:[a,f]}:a||f||{}
},_mergeWithPrevious:function(a){if(a){if(a instanceof c.Op.Unset)throw"You can't modify a relation after deleting it.";if(a instanceof c.Op.Relation){if(a._targetClassName&&a._targetClassName!==this._targetClassName)throw"Related object must be of class "+a._targetClassName+", but "+this._targetClassName+" was passed in.";var f=h.union(h.difference(a.relationsToAdd,this.relationsToRemove),this.relationsToAdd),e=h.union(h.difference(a.relationsToRemove,this.relationsToAdd),this.relationsToRemove),d=new c.Op.Relation(f,e);return d._targetClassName=this._targetClassName,d}throw"Op is invalid after previous op."}return this},_estimate:function(e,d,f){if(e){if(e instanceof c.Relation){if(this._targetClassName)if(e.targetClassName){if(e.targetClassName!==this._targetClassName)throw"Related object must be a "+e.targetClassName+", but a "+this._targetClassName+" was passed in."}else e.targetClassName=this._targetClassName;return e}throw"Op is invalid after previous op."}var a=new c.Relation(d,f);a.targetClassName=this._targetClassName}}),c.Op._registerDecoder("AddRelation",function(d){return new c.Op.Relation(c._decode(void 0,d.objects),[])}),c.Op._registerDecoder("RemoveRelation",function(d){return new c.Op.Relation([],c._decode(void 0,d.objects))})}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.Relation=function(e,d){this.parent=e,this.key=d,this.targetClassName=null},c.Relation.reverseQuery=function(e,a,f){var d=new c.Query(e);return d.equalTo(a,f._toPointer()),d},c.Relation.prototype={_ensureParentAndKey:function(e,d){if(this.parent=this.parent||e,this.key=this.key||d,this.parent!==e)throw"Internal Error. Relation retrieved from two different Objects.";if(this.key!==d)throw"Internal Error. Relation retrieved from two different keys."},add:function(d){h.isArray(d)||(d=[d]);var e=new c.Op.Relation(d,[]);this.parent.set(this.key,e),this.targetClassName=e._targetClassName},remove:function(d){h.isArray(d)||(d=[d]);var e=new c.Op.Relation([],d);this.parent.set(this.key,e),this.targetClassName=e._targetClassName},toJSON:function(){return{__type:"Relation",className:this.targetClassName}},query:function(){var d,e;return this.targetClassName?(d=c.Object._getSubclass(this.targetClassName),e=new c.Query(d)):(d=c.Object._getSubclass(this.parent.className),e=new c.Query(d),e._extraOptions.redirectClassNameForKey=this.key),e._addCondition("$relatedTo","object",this.parent._toPointer()),e._addCondition("$relatedTo","key",this.key),e}}}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.Promise=function(){this._resolved=!1,this._rejected=!1,this._resolvedCallbacks=[],this._rejectedCallbacks=[]},h.extend(c.Promise,{is:function(d){return d&&d.then&&h.isFunction(d.then)},as:function(){var d=new c.Promise;return d.resolve.apply(d,arguments),d},error:function(){var d=new c.Promise;return d.reject.apply(d,arguments),d},when:function(a){var i;i=a&&c._isNullOrUndefined(a.length)?arguments:a;var h=i.length,e=!1,f=[],_=[];if(f.length=i.length,_.length=i.length,0===h)return c.Promise.as.apply(this,f);var v=new c.Promise,d=function(){h-=1,0===h&&(e?v.reject(_):v.resolve.apply(v,f))};return c._arrayEach(i,function(l,m){c.Promise.is(l)?l.then(function(n){f[m]=n,d()},function(n){_[m]=n,e=!0,d()}):(f[m]=l,d())}),v},_continueWhile:function(d,e){return d()?e().then(function(){return c.Promise._continueWhile(d,e)}):c.Promise.as()}}),h.extend(c.Promise.prototype,{resolve:function(){if(this._resolved||this._rejected)throw"A promise was resolved even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._resolved=!0,this._result=arguments;var e=arguments;c._arrayEach(this._resolvedCallbacks,function(f){f.apply(this,e)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},reject:function(d){if(this._resolved||this._rejected)throw"A promise was rejected even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._rejected=!0,this._error=d,c._arrayEach(this._rejectedCallbacks,function(e){e(d)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},then:function(d,f){var a=new c.Promise,h=function(){var i=arguments;d&&(i=[d.apply(this,i)]),1===i.length&&c.Promise.is(i[0])?i[0].then(function(){a.resolve.apply(a,arguments)},function(c){a.reject(c)}):a.resolve.apply(a,i)},e=function(h){var i=[];f?(i=[f(h)],1===i.length&&c.Promise.is(i[0])?i[0].then(function(){a.resolve.apply(a,arguments)},function(c){a.reject(c)}):a.reject(i[0])):a.reject(h)};return this._resolved?h.apply(this,this._result):this._rejected?e(this._error):(this._resolvedCallbacks.push(h),this._rejectedCallbacks.push(e)),a},_thenRunCallbacks:function(f,e){var d;if(h.isFunction(f)){var a=f;d={success:function(c){a(c,null)},error:function(c){a(null,c)}}}else d=h.clone(f);return d=d||{},this.then(function(a){return d.success?d.success.apply(this,arguments):e&&e.trigger("sync",e,a,d),c.Promise.as.apply(c.Promise,arguments)},function(a){return d.error?h.isUndefined(e)?d.error(a):d.error(e,a):e&&e.trigger("error",e,a,d),c.Promise.error(a)})},_continueWith:function(d){return this.then(function(){return d(arguments,null)},function(e){return d(null,e)})}})}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=(c._,function(q){var m,o,a,p,n,l,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(a=q.length,o=0,m="";a>o;){if(p=255&q.charCodeAt(o++),o==a){m+=c.charAt(p>>2),m+=c.charAt((3&p)<<4),m+="==";break}if(n=q.charCodeAt(o++),o==a){m+=c.charAt(p>>2),m+=c.charAt((3&p)<<4|(240&n)>>4),m+=c.charAt((15&n)<<2),m+="=";break}l=q.charCodeAt(o++),m+=c.charAt(p>>2),m+=c.charAt((3&p)<<4|(240&n)>>4),m+=c.charAt((15&n)<<2|(192&l)>>6),m+=c.charAt(63&l)}return m}),_=function(m){var a,l,c,n;for(a="",c=m.length,l=0;c>l;l++)n=m.charCodeAt(l),n>=1&&127>=n?a+=m.charAt(l):n>2047?(a+=String.fromCharCode(224|n>>12&15),a+=String.fromCharCode(128|n>>6&63),a+=String.fromCharCode(128|n>>0&63)):(a+=String.fromCharCode(192|n>>6&31),a+=String.fromCharCode(128|n>>0&63));return a},f={ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",asc:"text/plain",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",cdf:"application/x-netcdf",cgm:"image/cgm","class":"application/octet-stream",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",dcr:"application/x-director",dif:"video/x-dv",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",docm:"application/vnd.ms-word.document.macroEnabled.12",dotm:"application/vnd.ms-word.template.macroEnabled.12",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",dxr:"application/x-director",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",ez:"application/andrew-inset",gif:"image/gif",gram:"application/srgs",grxml:"application/srgs+xml",gtar:"application/x-gtar",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htm:"text/html",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/x-javascript",kar:"audio/midi",latex:"application/x-latex",lha:"application/octet-stream",lzh:"application/octet-stream",m3u:"audio/x-mpegurl",m4a:"audio/mp4a-latm",m4b:"audio/mp4a-latm",m4p:"audio/mp4a-latm",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mac:"image/x-macpaint",man:"application/x-troff-man",mathml:"application/mathml+xml",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/vnd.mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",ms:"application/x-troff-ms",msh:"model/mesh",mxu:"video/vnd.mpegurl",nc:"application/x-netcdf",oda:"application/oda",ogg:"application/ogg",pbm:"image/x-portable-bitmap",pct:"image/pict",pdb:"chemical/x-pdb",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pic:"image/pict",pict:"image/pict",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",pntg:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ps:"application/postscript",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"application/x-troff",rtf:"text/rtf",rtx:"text/richtext",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",smi:"application/smil",smil:"application/smil",snd:"audio/basic",so:"application/octet-stream",spl:"application/x-futuresplash",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",swf:"application/x-shockwave-flash",t:"application/x-troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",tsv:"text/tab-separated-values",txt:"text/plain",ustar:"application/x-ustar",vcd:"application/x-cdlink",vrml:"model/vrml",vxml:"application/voicexml+xml",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wbmxl:"application/vnd.wap.wbxml",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wrl:"model/vrml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",zip:"application/zip"},e=function(a){var l=new c.Promise;if("undefined"==typeof FileReader)return c.Promise.error(new c.Error(-1,"Attempted to use a FileReader on an unsupported browser."));var i=new FileReader;return i.onloadend=function(){l.resolve(i.result)},i.readAsBinaryString(a),l};c.File=function(a,l,v){this._name=h(_(a));var i=c.User.current();this._metaData={owner:null!=i?i.id:"unknown"};var n=/\.([^.]*)$/.exec(a);n&&(n=n[1].toLowerCase());var m=v||f[n]||"text/plain";this._guessedType=m,"undefined"!=typeof File&&l instanceof File?this._source=e(l,v):(this._source=c.Promise.as(l,m),this._metaData.size=l.length)},c.File.prototype={name:function(){return this._name},setName:function(i){this._name=i},url:function(){return this._url},setUrl:function(i){this._url=i},cdn:function(){return this._cdn},metaData:function(i,a){return null!=i&&null!=a?(this._metaData[i]=a,this):null!=i?this._metaData[i]:this._metaData},destroy:function(i){if(!this._url&&!this._cdn)return c.Promise.error("The file url and cdn is not eixsts.")._thenRunCallbacks(i);var a={cdn:this._cdn,_ContentType:"application/json",url:this._url,metaData:self._metaData},h=c._request("2/files",null,null,"DELETE",a);return h._thenRunCallbacks(i)},save:function(a){var i=this;if(!i._previousSave){if(!i._source)throw"not source file";i._previousSave=i._source.then(function(a){var m={base64:h(a),_ContentType:"text/plain",mime_type:"text/plain",metaData:i._metaData};return i._metaData.size||(i._metaData.size=a.length),c._request("2/files",i._name,null,"POST",m)}).then(function(a){return i._name=a.filename,i._url=a.url,i._cdn=a.cdn,i})}return i._previousSave._thenRunCallbacks(a)}}}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.Object=function(d,e){if(h.isString(d))return c.Object._create.apply(this,arguments);d=d||{},e&&e.parse&&(d=this.parse(d));var f=c._getValue(this,"defaults");if(f&&(d=h.extend({},f,d)),e&&e.collection&&(this.collection=e.collection),this._serverData={},this._opSetQueue=[{}],this.attributes={},this._hashedJSON={},this._escapedAttributes={},this.cid=h.uniqueId("c"),this.changed={},this._silent={},this._pending={},!this.set(d,{silent:!0}))throw new Error("Can't create an invalid Bmob.Object");this.changed={},this._silent={},this._pending={},this._hasData=!0,this._previousAttributes=h.clone(this.attributes),this.initialize.apply(this,arguments)},c.Object.saveAll=function(e,d){return c.Object._deepSaveAsync(e)._thenRunCallbacks(d)},h.extend(c.Object.prototype,c.Events,{_existed:!1,_fetchWhenSave:!1,initialize:function(){},fetchWhenSave:function(d){if("boolean"!=typeof d)throw"Expect boolean value for fetchWhenSave";this._fetchWhenSave=d},toJSON:function(){var d=this._toFullJSON();return c._arrayEach(["__type","className"],function(e){delete d[e]}),d},_toFullJSON:function(e){var d=h.clone(this.attributes);return c._objectEach(d,function(a,f){d[f]=c._encode(a,e)}),c._objectEach(this._operations,function(a,f){d[f]=a}),h.has(this,"id")&&(d.objectId=this.id),h.has(this,"createdAt")&&(d.createdAt=h.isDate(this.createdAt)?this.createdAt.toJSON():this.createdAt),h.has(this,"updatedAt")&&(d.updatedAt=h.isDate(this.updatedAt)?this.updatedAt.toJSON():this.updatedAt),d.__type="Object",d.className=this.className,d},_refreshCache:function(){var d=this;d._refreshingCache||(d._refreshingCache=!0,c._objectEach(this.attributes,function(f,e){f instanceof c.Object?f._refreshCache():h.isObject(f)&&d._resetCacheForKey(e)&&d.set(e,new c.Op.Set(f),{silent:!0})}),delete d._refreshingCache)},dirty:function(d){this._refreshCache();var e=h.last(this._opSetQueue);return d?e[d]?!0:!1:this.id?h.keys(e).length>0?!0:!1:!0},_toPointer:function(){return{__type:"Pointer",className:this.className,objectId:this.id}},get:function(d){return this.attributes[d]},relation:function(d){var e=this.get(d);if(e){if(!(e instanceof c.Relation))throw"Called relation() on non-relation field "+d;return e._ensureParentAndKey(this,d),e}return new c.Relation(this,d)},escape:function(d){var e=this._escapedAttributes[d];if(e)return e;var f,a=this.attributes[d];return f=c._isNullOrUndefined(a)?"":h.escape(a.toString()),this._escapedAttributes[d]=f,f},has:function(d){return!c._isNullOrUndefined(this.attributes[d])},_mergeMagicFields:function(e){var d=this,f=["id","objectId","createdAt","updatedAt"];c._arrayEach(f,function(a){e[a]&&("objectId"===a?d.id=e[a]:d[a]=e[a],delete e[a])})},_startSave:function(){this._opSetQueue.push({})},_cancelSave:function(){var d=h.first(this._opSetQueue);this._opSetQueue=h.rest(this._opSetQueue);var f=h.first(this._opSetQueue);c._objectEach(d,function(a,c){var i=d[c],h=f[c];i&&h?f[c]=h._mergeWithPrevious(i):i&&(f[c]=i)}),this._saving=this._saving-1},_finishSave:function(f){var d={};c._traverse(this.attributes,function(a){a instanceof c.Object&&a.id&&a._hasData&&(d[a.id]=a)});var a=h.first(this._opSetQueue);this._opSetQueue=h.rest(this._opSetQueue),this._applyOpSet(a,this._serverData),this._mergeMagicFields(f);var e=this;c._objectEach(f,function(i,a){e._serverData[a]=c._decode(a,i);var h=c._traverse(e._serverData[a],function(a){return a instanceof c.Object&&d[a.id]?d[a.id]:void 0});h&&(e._serverData[a]=h)}),this._rebuildAllEstimatedData(),this._saving=this._saving-1},_finishFetch:function(f,e){this._opSetQueue=[{}],this._mergeMagicFields(f);var d=this;c._objectEach(f,function(a,h){d._serverData[h]=c._decode(h,a)}),this._rebuildAllEstimatedData(),this._refreshCache(),this._opSetQueue=[{}],this._hasData=e},_applyOpSet:function(e,f){var d=this;c._objectEach(e,function(a,h){f[h]=a._estimate(f[h],d,h),f[h]===c.Op._UNSET&&delete f[h]})},_resetCacheForKey:function(e){var f=this.attributes[e];if(!(!h.isObject(f)||f instanceof c.Object||f instanceof c.File)){f=f.toJSON?f.toJSON():f;var d=JSON.stringify(f);if(this._hashedJSON[e]!==d)return this._hashedJSON[e]=d,!0}return!1},_rebuildEstimatedDataForKey:function(e){var d=this;delete this.attributes[e],this._serverData[e]&&(this.attributes[e]=this._serverData[e]),c._arrayEach(this._opSetQueue,function(f){var a=f[e];a&&(d.attributes[e]=a._estimate(d.attributes[e],d,e),d.attributes[e]===c.Op._UNSET?delete d.attributes[e]:d._resetCacheForKey(e))})},_rebuildAllEstimatedData:function(){var d=this,e=h.clone(this.attributes);this.attributes=h.clone(this._serverData),c._arrayEach(this._opSetQueue,function(f){d._applyOpSet(f,d.attributes),c._objectEach(f,function(a,c){d._resetCacheForKey(c)})}),c._objectEach(e,function(f,a){d.attributes[a]!==f&&d.trigger("change:"+a,d,d.attributes[a],{})}),c._objectEach(this.attributes,function(a,f){h.has(e,f)||d.trigger("change:"+f,d,a,{})})},set:function(i,a,l){var _;if(h.isObject(i)||c._isNullOrUndefined(i)?(_=i,c._objectEach(_,function(n,m){_[m]=c._decode(m,n)}),l=a):(_={},_[i]=c._decode(i,a)),l=l||{},!_)return this;_ instanceof c.Object&&(_=_.attributes),l.unset&&c._objectEach(_,function(m,n){_[n]=new c.Op.Unset});var f=h.clone(_),v=this;if(c._objectEach(f,function(n,m){n instanceof c.Op&&(f[m]=n._estimate(v.attributes[m],v,m),f[m]===c.Op._UNSET&&delete f[m])}),!this._validate(_,l))return!1;this._mergeMagicFields(_),l.changes={};{var d=this._escapedAttributes;this._previousAttributes||{}}return c._arrayEach(h.keys(_),function(n){var p=_[n];p instanceof c.Relation&&(p.parent=v),p instanceof c.Op||(p=new c.Op.Set(p));var m=!0;p instanceof c.Op.Set&&h.isEqual(v.attributes[n],p.value)&&(m=!1),m&&(delete d[n],l.silent?v._silent[n]=!0:l.changes[n]=!0);var o=h.last(v._opSetQueue);o[n]=p._mergeWithPrevious(o[n]),v._rebuildEstimatedDataForKey(n),m?(v.changed[n]=v.attributes[n],l.silent||(v._pending[n]=!0)):(delete v.changed[n],delete v._pending[n])}),l.silent||this.change(l),this},unset:function(d,e){return e=e||{},e.unset=!0,this.set(d,null,e)},increment:function(d,e){return(h.isUndefined(e)||h.isNull(e))&&(e=1),this.set(d,new c.Op.Increment(e))},add:function(d,e){return this.set(d,new c.Op.Add([e]))},addUnique:function(d,e){return this.set(d,new c.Op.AddUnique([e]))},remove:function(d,e){return this.set(d,new c.Op.Remove([e]))},op:function(d){return h.last(this._opSetQueue)[d]},clear:function(d){d=d||{},d.unset=!0;var e=h.extend(this.attributes,this._operations);return this.set(e,d)},_getSaveJSON:function(){var d=h.clone(h.first(this._opSetQueue));return c._objectEach(d,function(f,e){d[e]=f.toJSON()}),d},_canBeSerialized:function(){return c.Object._canBeSerializedAsValue(this.attributes)},fetch:function(e){var d=this,f=c._request("classes",this.className,this.id,"GET");return f.then(function(a,c,i){return d._finishFetch(d.parse(a,c,i),!0),d})._thenRunCallbacks(e,this)},save:function(a,_,v){var p,l,s;if(h.isObject(a)||c._isNullOrUndefined(a)?(p=a,s=_):(p={},p[a]=_,s=v),!s&&p){var q=h.reject(p,function(t,i){return h.include(["success","error","wait"],i)});if(0===q.length){var r=!0;if(h.has(p,"success")&&!h.isFunction(p.success)&&(r=!1),h.has(p,"error")&&!h.isFunction(p.error)&&(r=!1),r)return this.save(null,p)}}s=h.clone(s)||{},s.wait&&(l=h.clone(this.attributes));var m=h.clone(s)||{};m.wait&&(m.silent=!0);var e;if(m.error=function(t,i){e=i},p&&!this.set(p,m))return c.Promise.error(e)._thenRunCallbacks(s,this);var g=this;g._refreshCache();var n=[],d=[];return c.Object._findUnsavedChildren(g.attributes,n,d),n.length+d.length>0?c.Object._deepSaveAsync(this.attributes).then(function(){return g.save(null,s)},function(i){return c.Promise.error(i)._thenRunCallbacks(s,g)}):(this._startSave(),this._saving=(this._saving||0)+1,this._allPreviousSaves=this._allPreviousSaves||c.Promise.as(),this._allPreviousSaves=this._allPreviousSaves._continueWith(function(){var a=g.id?"PUT":"POST",t=g._getSaveJSON();"PUT"===a&&g._fetchWhenSave&&(t._fetchWhenSave=!0);var i="classes",u=g.className;"_User"!==g.className||g.id||(i="users",u=null);var _=c._request(i,u,g.id,a,t);return _=_.then(function(a,x,c){var _=g.parse(a,x,c);return s.wait&&(_=h.extend(p||{},_)),g._finishSave(_),s.wait&&g.set(l,m),g},function(x){return g._cancelSave(),c.Promise.error(x)})._thenRunCallbacks(s,g)}),this._allPreviousSaves)},destroy:function(e){e=e||{};var d=this,a=function(){d.trigger("destroy",d,d.collection,e)};if(!this.id)return a();e.wait||a();var f=c._request("classes",this.className,this.id,"DELETE");return f.then(function(){return e.wait&&a(),d})._thenRunCallbacks(e,this)},parse:function(a,d){var e=h.clone(a);return h(["createdAt","updatedAt"]).each(function(a){e[a]&&(e[a]=e[a])}),e.updatedAt||(e.updatedAt=e.createdAt),d&&(this._existed=201!==d),e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.id},change:function(f){f=f||{};var a=this._changing;this._changing=!0;var e=this;c._objectEach(this._silent,function(i){e._pending[i]=!0});var _=h.extend({},f.changes,this._silent);if(this._silent={},c._objectEach(_,function(a,i){e.trigger("change:"+i,e,e.get(i),f)}),a)return this;for(var d=function(a,i){e._pending[i]||e._silent[i]||delete e.changed[i]};!h.isEmpty(this._pending);)this._pending={},this.trigger("change",this,f),c._objectEach(this.changed,d),e._previousAttributes=h.clone(this.attributes);return this._changing=!1,this},existed:function(){return this._existed},hasChanged:function(d){return arguments.length?this.changed&&h.has(this.changed,d):!h.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?h.clone(this.changed):!1;var f={},d=this._previousAttributes;return c._objectEach(e,function(a,c){h.isEqual(d[c],a)||(f[c]=a)}),f},previous:function(d){return arguments.length&&this._previousAttributes?this._previousAttributes[d]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},validate:function(e){return!h.has(e,"ACL")||e.ACL instanceof c.ACL?!1:new c.Error(c.Error.OTHER_CAUSE,"ACL must be a Bmob.ACL.")},_validate:function(f,e){if(e.silent||!this.validate)return!0;f=h.extend({},this.attributes,f);var d=this.validate(f,e);return d?(e&&e.error?e.error(this,d,e):this.trigger("error",this,d,e),!1):!0},getACL:function(){return this.get("ACL")},setACL:function(e,d){return this.set("ACL",e,d)}}),c.Object.createWithoutData=function(f,a,e){var d=new c.Object(f);return d.id=a,d._hasData=e,d},c.Object.destroyAll=function(a,e){if(null==a||0==a.length)return c.Promise.as()._thenRunCallbacks(e);var f=a[0].className,i="",d=!0;a.forEach(function(a){if(a.className!=f)throw"Bmob.Object.destroyAll requires the argument object array's classNames must be the same";if(!a.id)throw"Could not delete unsaved object";d?(i=a.id,d=!1):i=i+","+a.id});var h=c._request("classes",f,i,"DELETE");return h._thenRunCallbacks(e)},c.Object._getSubclass=function(e){if(!h.isString(e))throw"Bmob.Object._getSubclass requires a string argument.";var d=c.Object._classMap[e];return d||(d=c.Object.extend(e),c.Object._classMap[e]=d),d},c.Object._create=function(a,d,e){var f=c.Object._getSubclass(a);return new f(d,e)},c.Object._classMap={},c.Object._extend=c._extend,c.Object.extend=function(a,f,_){if(!h.isString(a)){if(a&&h.has(a,"className"))return c.Object.extend(a.className,a,f);throw new Error("Bmob.Object.extend's first argument should be the className.")}"User"===a&&(a="_User");var d=null;if(h.has(c.Object._classMap,a)){var e=c.Object._classMap[a];d=e._extend(f,_)}else f=f||{},f.className=a,d=this._extend(f,_);return d.extend=function(_){if(h.isString(_)||_&&h.has(_,"className"))return c.Object.extend.apply(d,arguments);var i=[a].concat(c._.toArray(arguments));return c.Object.extend.apply(d,i)},c.Object._classMap[a]=d,d},c.Object._findUnsavedChildren=function(d,e,f){c._traverse(d,function(a){return a instanceof c.Object?(a._refreshCache(),void(a.dirty()&&e.push(a))):a instanceof c.File?void(a.url()||f.push(a)):void 0})},c.Object._canBeSerializedAsValue=function(d){var e=!0;return d instanceof c.Object?e=!!d.id:h.isArray(d)?c._arrayEach(d,function(f){c.Object._canBeSerializedAsValue(f)||(e=!1)}):h.isObject(d)&&c._objectEach(d,function(f){c.Object._canBeSerializedAsValue(f)||(e=!1)}),e},c.Object._deepSaveAsync=function(e){var d=[],a=[];c.Object._findUnsavedChildren(e,d,a);var i=c.Promise.as();h.each(a,function(a){i=i.then(function(){return a.save()})});var _=h.uniq(d),f=h.uniq(_);return i.then(function(){return c.Promise._continueWhile(function(){return f.length>0},function(){var m=[],a=[];if(c._arrayEach(f,function(n){return m.length>20?void a.push(n):void(n._canBeSerialized()?m.push(n):a.push(n))}),f=a,0===m.length)return c.Promise.error(new c.Error(c.Error.OTHER_CAUSE,"Tried to save a batch with a cycle."));var _=c.Promise.when(h.map(m,function(n){return n._allPreviousSaves||c.Promise.as()})),l=new c.Promise;return c._arrayEach(m,function(n){n._allPreviousSaves=l}),_._continueWith(function(){return c._request("batch",null,null,"POST",{requests:h.map(m,function(n){var o=n._getSaveJSON(),q="POST",p="/1/classes/"+n.className;return n.id&&(p=p+"/"+n.id,q="PUT"),n._startSave(),{method:q,path:p,body:o}})}).then(function(o,n,q){var p;return c._arrayEach(m,function(r,s){o[s].success?r._finishSave(r.parse(o[s].success,n,q)):(p=p||o[s].error,r._cancelSave())}),p?c.Promise.error(new c.Error(p.code,p.error)):void 0}).then(function(n){return l.resolve(n),n},function(n){return l.reject(n),c.Promise.error(n)})})})}).then(function(){return e})}}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.Role=c.Object.extend("_Role",{constructor:function(d,e){h.isString(d)&&e instanceof c.ACL?(c.Object.prototype.constructor.call(this,null,null),this.setName(d),this.setACL(e)):c.Object.prototype.constructor.call(this,d,e)},getName:function(){return this.get("name")},setName:function(e,d){return this.set("name",e,d)},getUsers:function(){return this.relation("users")},getRoles:function(){return this.relation("roles")},validate:function(f,e){if("name"in f&&f.name!==this.getName()){var d=f.name;if(this.id&&this.id!==f.objectId)return new c.Error(c.Error.OTHER_CAUSE,"A role's name can only be set before it has been saved.");if(!h.isString(d))return new c.Error(c.Error.OTHER_CAUSE,"A role's name must be a String.");if(!/^[0-9a-zA-Z\-_ ]+$/.test(d))return new c.Error(c.Error.OTHER_CAUSE,"A role's name can only contain alphanumeric characters, _, -, and spaces.")}return c.Object.prototype.validate?c.Object.prototype.validate.call(this,f,e):!1}})}(this),function(a){a.Bmob=a.Bmob||{};var d=a.Bmob,c=d._;d.Collection=function(f,e){e=e||{},e.comparator&&(this.comparator=e.comparator),e.model&&(this.model=e.model),e.query&&(this.query=e.query),this._reset(),this.initialize.apply(this,arguments),f&&this.reset(f,{silent:!0,parse:e.parse})},c.extend(d.Collection.prototype,d.Events,{model:d.Object,initialize:function(){},toJSON:function(){return this.map(function(e){return e.toJSON()})},add:function(f,o){var a,m,h,l,n,_,v={},e={};for(o=o||{},f=c.isArray(f)?f.slice():[f],a=0,h=f.length;h>a;a++){if(f[a]=this._prepareModel(f[a],o),l=f[a],!l)throw new Error("Can't add an invalid model to a collection");if(n=l.cid,v[n]||this._byCid[n])throw new Error("Duplicate cid: can't add the same model to a collection twice");if(_=l.id,!d._isNullOrUndefined(_)&&(e[_]||this._byId[_]))throw new Error("Duplicate id: can't add the same model to a collection twice");e[_]=l,v[n]=l}for(a=0;h>a;a++)(l=f[a]).on("all",this._onModelEvent,this),this._byCid[l.cid]=l,l.id&&(this._byId[l.id]=l);if(this.length+=h,m=d._isNullOrUndefined(o.at)?this.models.length:o.at,this.models.splice.apply(this.models,[m,0].concat(f)),this.comparator&&this.sort({silent:!0}),o.silent)return this;for(a=0,h=this.models.length;h>a;a++)l=this.models[a],v[l.cid]&&(o.index=a,l.trigger("add",l,this,o));return this},remove:function(a,h){var _,e,v,f;for(h=h||{},a=c.isArray(a)?a.slice():[a],_=0,e=a.length;e>_;_++)f=this.getByCid(a[_])||this.get(a[_]),f&&(delete this._byId[f.id],delete this._byCid[f.cid],v=this.indexOf(f),this.models.splice(v,1),this.length--,h.silent||(h.index=v,f.trigger("remove",f,this,h)),this._removeReference(f));return this},get:function(e){return e&&this._byId[e.id||e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},sort:function(f){if(f=f||{},!this.comparator)throw new Error("Cannot sort a set without a comparator");var e=c.bind(this.comparator,this);return 1===this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),f.silent||this.trigger("reset",this,f),this},pluck:function(e){return c.map(this.models,function(f){return f.get(e)})},reset:function(a,f){var e=this;return a=a||[],f=f||{},d._arrayEach(this.models,function(a){e._removeReference(a)}),this._reset(),this.add(a,{silent:!0,parse:f.parse}),f.silent||this.trigger("reset",this,f),this},fetch:function(e){e=c.clone(e)||{},void 0===e.parse&&(e.parse=!0);var a=this,f=this.query||new d.Query(this.model);return f.find().then(function(c){return e.add?a.add(c,e):a.reset(c,e),a})._thenRunCallbacks(e,this)},create:function(f,e){var a=this;if(e=e?c.clone(e):{},f=this._prepareModel(f,e),!f)return!1;e.wait||a.add(f,e);var h=e.success;return e.success=function(i,c){e.wait&&a.add(i,e),h?h(i,c):i.trigger("sync",f,c,e)},f.save(null,e),f},parse:function(f){return f},chain:function(){return c(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(a,f){if(a instanceof d.Object)a.collection||(a.collection=this);else{var e=a;f.collection=this,a=new this.model(e,f),a._validate(a.attributes,f)||(a=!1)}return a},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(a,f,c,e){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(f,e),f&&"change:objectId"===a&&(delete this._byId[f.previous("objectId")],this._byId[f.id]=f),this.trigger.apply(this,arguments))}});var h=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];d._arrayEach(h,function(e){d.Collection.prototype[e]=function(){return c[e].apply(c,[this.models].concat(c.toArray(arguments)))}}),d.Collection.extend=d._extend}(this),function(a){a.Bmob=a.Bmob||{};var e=a.Bmob,d=e._;e.View=function(f){this.cid=d.uniqueId("view"),this._configure(f||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()};var c=/^(\S+)\s*(.*)$/,h=["model","collection","el","id","attributes","className","tagName"];d.extend(e.View.prototype,e.Events,{tagName:"div",$:function(f){return this.$el.find(f)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(a,f,i){var c=document.createElement(a);return f&&e.$(c).attr(f),i&&e.$(c).html(i),c},setElement:function(f,a){return this.$el=e.$(f),this.el=this.$el[0],a!==!1&&this.delegateEvents(),this
},delegateEvents:function(a){if(a=a||e._getValue(this,"events")){this.undelegateEvents();var f=this;e._objectEach(a,function(l,h){if(d.isFunction(l)||(l=f[a[h]]),!l)throw new Error('Event "'+a[h]+'" does not exist');var _=h.match(c),i=_[1],v=_[2];l=d.bind(l,f),i+=".delegateEvents"+f.cid,""===v?f.$el.bind(i,l):f.$el.delegate(v,i,l)})}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=d.extend({},this.options,a));var f=this;d.each(h,function(c){a[c]&&(f[c]=a[c])}),this.options=a},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var f=e._getValue(this,"attributes")||{};this.id&&(f.id=this.id),this.className&&(f["class"]=this.className),this.setElement(this.make(this.tagName,f),!1)}}}),e.View.extend=e._extend}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.User=c.Object.extend("_User",{_isCurrentUser:!1,_mergeMagicFields:function(d){d.sessionToken&&(this._sessionToken=d.sessionToken,delete d.sessionToken),c.User.__super__._mergeMagicFields.call(this,d)},_cleanupAuthData:function(){if(this.isCurrent()){var d=this.get("authData");d&&c._objectEach(this.get("authData"),function(f,e){d[e]||delete d[e]})}},_synchronizeAllAuthData:function(){var e=this.get("authData");if(e){var d=this;c._objectEach(this.get("authData"),function(a,f){d._synchronizeAuthData(f)})}},_synchronizeAuthData:function(a){if(this.isCurrent()){var d;h.isString(a)?(d=a,a=c.User._authProviders[d]):d=a.getAuthType();var e=this.get("authData");if(e&&a){var f=a.restoreAuthentication(e[d]);f||this._unlinkFrom(a)}}},_handleSaveResult:function(d){d&&(this._isCurrentUser=!0),this._cleanupAuthData(),this._synchronizeAllAuthData(),delete this._serverData.password,this._rebuildEstimatedDataForKey("password"),this._refreshCache(),(d||this.isCurrent())&&c.User._saveCurrentUser(this)},_linkWith:function(a,f){var e;if(h.isString(a)?(e=a,a=c.User._authProviders[a]):e=a.getAuthType(),h.has(f,"authData")){var _=this.get("authData")||{};_[e]=f.authData,this.set("authData",_);var i=h.clone(f)||{};return i.success=function(a){a._handleSaveResult(!0),f.success&&f.success.apply(this,arguments)},this.save({authData:_},i)}var d=this,v=new c.Promise;return a.authenticate({success:function(l,a){d._linkWith(l,{authData:a,success:f.success,error:f.error}).then(function(){v.resolve(d)})},error:function(l,a){f.error&&f.error(d,a),v.reject(a)}}),v},_unlinkFrom:function(a,f){var e;h.isString(a)?(e=a,a=c.User._authProviders[a]):e=a.getAuthType();var _=h.clone(f),d=this;return _.authData=null,_.success=function(){d._synchronizeAuthData(a),f.success&&f.success.apply(this,arguments)},this._linkWith(a,_)},_isLinked:function(f){var d;d=h.isString(f)?f:f.getAuthType();var e=this.get("authData")||{};return!!e[d]},_logOutWithAll:function(){var e=this.get("authData");if(e){var d=this;c._objectEach(this.get("authData"),function(a,f){d._logOutWith(f)})}},_logOutWith:function(d){this.isCurrent()&&(h.isString(d)&&(d=c.User._authProviders[d]),d&&d.deauthenticate&&d.deauthenticate())},signUp:function(a,f){var e;f=f||{};var i=a&&a.username||this.get("username");if(!i||""===i)return e=new c.Error(c.Error.OTHER_CAUSE,"Cannot sign up user with an empty name."),f&&f.error&&f.error(this,e),c.Promise.error(e);var d=a&&a.password||this.get("password");if(!d||""===d)return e=new c.Error(c.Error.OTHER_CAUSE,"Cannot sign up user with an empty password."),f&&f.error&&f.error(this,e),c.Promise.error(e);var _=h.clone(f);return _.success=function(a){a._handleSaveResult(!0),f.success&&f.success.apply(this,arguments)},this.save(a,_)},logIn:function(e){var d=this,f=c._request("login",null,null,"GET",this.toJSON());return f.then(function(a,c,i){var h=d.parse(a,c,i);return d._finishFetch(h),d._handleSaveResult(!0),d})._thenRunCallbacks(e,this)},save:function(a,_,f){var l,m;h.isObject(a)||h.isNull(a)||h.isUndefined(a)?(l=a,m=_):(l={},l[a]=_,m=f),m=m||{};var d=h.clone(m);return d.success=function(i){i._handleSaveResult(!1),m.success&&m.success.apply(this,arguments)},c.Object.prototype.save.call(this,l,d)},fetch:function(d){var e=d?h.clone(d):{};return e.success=function(f){f._handleSaveResult(!1),d&&d.success&&d.success.apply(this,arguments)},c.Object.prototype.fetch.call(this,e)},isCurrent:function(){return this._isCurrentUser},getUsername:function(){return this.get("username")},setUsername:function(e,d){return this.set("username",e,d)},setPassword:function(e,d){return this.set("password",e,d)},getEmail:function(){return this.get("email")},setEmail:function(e,d){return this.set("email",e,d)},authenticated:function(){return!!this._sessionToken&&c.User.current()&&c.User.current().id===this.id}},{_currentUser:null,_currentUserMatchesDisk:!1,_CURRENT_USER_KEY:"currentUser",_authProviders:{},signUp:function(a,h,f,e){f=f||{},f.username=a,f.password=h;var d=c.Object._create("_User");return d.signUp(f,e)},logIn:function(a,f,e){var d=c.Object._create("_User");return d._finishFetch({username:a,password:f}),d.logIn(e)},logOut:function(){null!==c.User._currentUser&&(c.User._currentUser._logOutWithAll(),c.User._currentUser._isCurrentUser=!1),c.User._currentUserMatchesDisk=!0,c.User._currentUser=null,c.localStorage.removeItem(c._getBmobPath(c.User._CURRENT_USER_KEY))},requestPasswordReset:function(e,d){var f={email:e},a=c._request("requestPasswordReset",null,null,"POST",f);return a._thenRunCallbacks(d)},requestEmailVerify:function(e,d){var f={email:e},a=c._request("requestEmailVerify",null,null,"POST",f);return a._thenRunCallbacks(d)},current:function(){if(c.User._currentUser)return c.User._currentUser;if(c.User._currentUserMatchesDisk)return c.User._currentUser;c.User._currentUserMatchesDisk=!0;var d=c.localStorage.getItem(c._getBmobPath(c.User._CURRENT_USER_KEY));if(!d)return null;c.User._currentUser=c.Object._create("_User"),c.User._currentUser._isCurrentUser=!0;var e=JSON.parse(d);return c.User._currentUser.id=e._id,delete e._id,c.User._currentUser._sessionToken=e._sessionToken,delete e._sessionToken,c.User._currentUser.set(e),c.User._currentUser._synchronizeAllAuthData(),c.User._currentUser._refreshCache(),c.User._currentUser._opSetQueue=[{}],c.User._currentUser},_saveCurrentUser:function(d){c.User._currentUser!==d&&c.User.logOut(),d._isCurrentUser=!0,c.User._currentUser=d,c.User._currentUserMatchesDisk=!0;var e=d.toJSON();e._id=d.id,e._sessionToken=d._sessionToken,c.localStorage.setItem(c._getBmobPath(c.User._CURRENT_USER_KEY),JSON.stringify(e))},_registerAuthenticationProvider:function(d){c.User._authProviders[d.getAuthType()]=d,c.User.current()&&c.User.current()._synchronizeAuthData(d.getAuthType())},_logInWith:function(f,e){var d=c.Object._create("_User");return d._linkWith(f,e)}})}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.Query=function(d){h.isString(d)&&(d=c.Object._getSubclass(d)),this.objectClass=d,this.className=d.prototype.className,this._where={},this._include=[],this._limit=-1,this._skip=0,this._extraOptions={}},c.Query.or=function(){var d=h.toArray(arguments),e=null;c._arrayEach(d,function(a){if(h.isNull(e)&&(e=a.className),e!==a.className)throw"All queries must be for the same class"});var f=new c.Query(e);return f._orQuery(d),f},c.Query._extend=c._extend,c.Query.prototype={_processResult:function(d){return d},get:function(d,f){var e=this;return e.equalTo("objectId",d),e.first().then(function(a){if(a)return a;var h=new c.Error(c.Error.OBJECT_NOT_FOUND,"Object not found.");return c.Promise.error(h)})._thenRunCallbacks(f,null)},toJSON:function(){var d={where:this._where};return this._include.length>0&&(d.include=this._include.join(",")),this._select&&(d.keys=this._select.join(",")),this._limit>=0&&(d.limit=this._limit),this._skip>0&&(d.skip=this._skip),void 0!==this._order&&(d.order=this._order),c._objectEach(this._extraOptions,function(f,e){d[e]=f}),d},_newObject:function(d){return obj=d&&d.className?new c.Object(d.className):new this.objectClass},_createRequest:function(d){return c._request("classes",this.className,null,"GET",d||this.toJSON())},find:function(e){var d=this,f=this._createRequest();return f.then(function(a){return h.map(a.results,function(c){var i=d._newObject(a);return i._finishFetch(d._processResult(c),!0),i})})._thenRunCallbacks(e)},destroyAll:function(e){var d=this;return d.find().then(function(f){return c.Object.destroyAll(f)})._thenRunCallbacks(e)},count:function(d){var f=this.toJSON();f.limit=0,f.count=1;var e=this._createRequest(f);return e.then(function(a){return a.count})._thenRunCallbacks(d)},first:function(e){var d=this,a=this.toJSON();a.limit=1;var f=this._createRequest(a);return f.then(function(a){return h.map(a.results,function(i){var a=d._newObject();return a._finishFetch(d._processResult(i),!0),a})[0]})._thenRunCallbacks(e)},collection:function(d,e){return e=e||{},new c.Collection(d,h.extend(e,{model:this._objectClass||this.objectClass,query:this}))},skip:function(d){return this._skip=d,this},limit:function(d){return this._limit=d,this},equalTo:function(d,e){return this._where[d]=c._encode(e),this},_addCondition:function(d,f,e){return this._where[d]||(this._where[d]={}),this._where[d][f]=c._encode(e),this},notEqualTo:function(d,e){return this._addCondition(d,"$ne",e),this},lessThan:function(d,e){return this._addCondition(d,"$lt",e),this},greaterThan:function(d,e){return this._addCondition(d,"$gt",e),this},lessThanOrEqualTo:function(d,e){return this._addCondition(d,"$lte",e),this},greaterThanOrEqualTo:function(d,e){return this._addCondition(d,"$gte",e),this},containedIn:function(e,d){return this._addCondition(e,"$in",d),this},notContainedIn:function(e,d){return this._addCondition(e,"$nin",d),this},containsAll:function(e,d){return this._addCondition(e,"$all",d),this},exists:function(d){return this._addCondition(d,"$exists",!0),this},doesNotExist:function(d){return this._addCondition(d,"$exists",!1),this},matches:function(e,f,d){return this._addCondition(e,"$regex",f),d||(d=""),f.ignoreCase&&(d+="i"),f.multiline&&(d+="m"),d&&d.length&&this._addCondition(e,"$options",d),this},matchesQuery:function(d,f){var e=f.toJSON();return e.className=f.className,this._addCondition(d,"$inQuery",e),this},doesNotMatchQuery:function(d,f){var e=f.toJSON();return e.className=f.className,this._addCondition(d,"$notInQuery",e),this},matchesKeyInQuery:function(e,d,a){var f=a.toJSON();return f.className=a.className,this._addCondition(e,"$select",{key:d,query:f}),this},doesNotMatchKeyInQuery:function(e,d,a){var f=a.toJSON();return f.className=a.className,this._addCondition(e,"$dontSelect",{key:d,query:f}),this},_orQuery:function(d){var e=h.map(d,function(f){return f.toJSON().where});return this._where.$or=e,this},_quote:function(d){return"\\Q"+d.replace("\\E","\\E\\\\E\\Q")+"\\E"},contains:function(d,e){return this._addCondition(d,"$regex",this._quote(e)),this},startsWith:function(d,e){return this._addCondition(d,"$regex","^"+this._quote(e)),this},endsWith:function(d,e){return this._addCondition(d,"$regex",this._quote(e)+"$"),this},ascending:function(d){return this._order=c._isNullOrUndefined(this._order)?d:this._order+","+d,this},cleanOrder:function(){return this._order=null,this},descending:function(d){return this._order=c._isNullOrUndefined(this._order)?"-"+d:this._order+",-"+d,this},near:function(e,d){return d instanceof c.GeoPoint||(d=new c.GeoPoint(d)),this._addCondition(e,"$nearSphere",d),this},withinRadians:function(e,d,f){return this.near(e,d),this._addCondition(e,"$maxDistance",f),this},withinMiles:function(e,d,f){return this.withinRadians(e,d,f/3958.8)},withinKilometers:function(e,d,f){return this.withinRadians(e,d,f/6371)},withinGeoBox:function(d,f,e){return f instanceof c.GeoPoint||(f=new c.GeoPoint(f)),e instanceof c.GeoPoint||(e=new c.GeoPoint(e)),this._addCondition(d,"$within",{$box:[f,e]}),this},include:function(){var d=this;return c._arrayEach(arguments,function(e){h.isArray(e)?d._include=d._include.concat(e):d._include.push(e)}),this},select:function(){var d=this;return this._select=this._select||[],c._arrayEach(arguments,function(e){h.isArray(e)?d._select=d._select.concat(e):d._select.push(e)}),this},each:function(i,e){if(e=e||{},this._order||this._skip||this._limit>=0){var d="Cannot iterate on a query with sort, skip, or limit.";return c.Promise.error(d)._thenRunCallbacks(e)}var f=(new c.Promise,new c.Query(this.objectClass));f._limit=e.batchSize||100,f._where=h.clone(this._where),f._include=h.clone(this._include),f.ascending("objectId");var a=!1;return c.Promise._continueWhile(function(){return!a},function(){return f.find().then(function(h){var _=c.Promise.as();return c._.each(h,function(l){_=_.then(function(){return i(l)})}),_.then(function(){h.length>=f._limit?f.greaterThan("objectId",h[h.length-1].id):a=!0})})})._thenRunCallbacks(e)}},c.FriendShipQuery=c.Query._extend({_objectClass:c.User,_newObject:function(){return new c.User},_processResult:function(e){var d=e[this._friendshipTag];return"Pointer"===d.__type&&"_User"===d.className&&(delete d.__type,delete d.className),d}})}(this),function(a){a.Bmob=a.Bmob||{};var d=a.Bmob,c=d._;d.History=function(){this.handlers=[],c.bindAll(this,"checkUrl")};var e=/^[#\/]/,h=/msie [\w.]+/;d.History.started=!1,c.extend(d.History.prototype,d.Events,{interval:50,getHash:function(a){var c=a?a.location:window.location,f=c.href.match(/#(.*)$/);return f?f[1]:""},getFragment:function(a,f){if(d._isNullOrUndefined(a))if(this._hasPushState||f){a=window.location.pathname;var c=window.location.search;c&&(a+=c)}else a=this.getHash();return a.indexOf(this.options.root)||(a=a.substr(this.options.root.length)),a.replace(e,"")},start:function(a){if(d.History.started)throw new Error("Bmob.history has already been started");d.History.started=!0,this.options=c.extend({},{root:"/"},this.options,a),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var _=this.getFragment(),f=document.documentMode,v=h.exec(navigator.userAgent.toLowerCase())&&(!f||7>=f);v&&(this.iframe=d.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(_)),this._hasPushState?d.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!v?d.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=window.setInterval(this.checkUrl,this.interval)),this.fragment=_;var g=window.location,i=g.pathname===this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!i?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&i&&g.hash&&(this.fragment=this.getHash().replace(e,""),window.history.replaceState({},document.title,g.protocol+"//"+g.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){d.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),window.clearInterval(this._checkUrlInterval),d.History.started=!1},route:function(f,a){this.handlers.unshift({route:f,callback:a})},checkUrl:function(){var f=this.getFragment();return f===this.fragment&&this.iframe&&(f=this.getFragment(this.getHash(this.iframe))),f===this.fragment?!1:(this.iframe&&this.navigate(f),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(a){var h=this.fragment=this.getFragment(a),f=c.any(this.handlers,function(i){return i.route.test(h)?(i.callback(h),!0):void 0});return f},navigate:function(a,c){if(!d.History.started)return!1;c&&c!==!0||(c={trigger:c});var i=(a||"").replace(e,"");if(this.fragment!==i){if(this._hasPushState){0!==i.indexOf(this.options.root)&&(i=this.options.root+i),this.fragment=i;var f=c.replace?"replaceState":"pushState";window.history[f]({},document.title,i)}else this._wantsHashChange?(this.fragment=i,this._updateHash(window.location,i,c.replace),this.iframe&&i!==this.getFragment(this.getHash(this.iframe))&&(c.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,i,c.replace))):window.location.assign(this.options.root+a);c.trigger&&this.loadUrl(a)}},_updateHash:function(f,a,c){if(c){var i=f.toString().replace(/(javascript:|#).*$/,"");f.replace(i+"#"+a)}else f.hash=a}})}(this),function(a){a.Bmob=a.Bmob||{};var d=a.Bmob,c=d._;d.Router=function(a){a=a||{},a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var e=/:\w+/g,f=/\*\w+/g,h=/[\-\[\]{}()+?.,\\\^\$\|#\s]/g;c.extend(d.Router.prototype,d.Events,{initialize:function(){},route:function(a,h,i){return d.history=d.history||new d.History,c.isRegExp(a)||(a=this._routeToRegExp(a)),i||(i=this[h]),d.history.route(a,c.bind(function(c){var _=this._extractParameters(a,c);i&&i.apply(this,_),this.trigger.apply(this,["route:"+h].concat(_)),d.history.trigger("route",this,h,_)},this)),this},navigate:function(a,c){d.history.navigate(a,c)},_bindRoutes:function(){if(this.routes){var a=[];for(var c in this.routes)this.routes.hasOwnProperty(c)&&a.unshift([c,this.routes[c]]);for(var h=0,_=a.length;_>h;h++)this.route(a[h][0],a[h][1],this[a[h][1]])}},_routeToRegExp:function(a){return a=a.replace(h,"\\$&").replace(e,"([^/]+)").replace(f,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,c){return a.exec(c).slice(1)}}),d.Router.extend=d._extend}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.Image=c.Image||{},h.extend(c.Image,{thumbnail:function(f){var e=c._request("images/thumbnail",null,null,"POST",c._encode(f,null,!0));return e.then(function(a){return a})},watermark:function(f){var e=c._request("images/watermark",null,null,"POST",c._encode(f,null,!0));return e.then(function(a){return a})}})}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.Sms=c.Sms||{},h.extend(c.Sms,{requestSms:function(f,d){var e=c._request("requestSms",null,null,"POST",c._encode(f,null,!0));return e.then(function(a){return c._decode(null,a)})._thenRunCallbacks(d)},requestSmsCode:function(f,d){var e=c._request("requestSmsCode",null,null,"POST",c._encode(f,null,!0));return e.then(function(a){return c._decode(null,a)})._thenRunCallbacks(d)},verifySmsCode:function(f,a,d){data={mobilePhoneNumber:f};var e=c._request("verifySmsCode/"+a,null,null,"POST",c._encode(data,null,!0));return e.then(function(a){return c._decode(null,a)})._thenRunCallbacks(d)},querySms:function(e,d){var f=c._request("querySms/"+e,null,null,"GET",null);return f.then(function(a){return c._decode(null,a)})._thenRunCallbacks(d)}})}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.Pay=c.Pay||{},h.extend(c.Pay,{webPay:function(a,i,d,e){var h={order_price:a,product_name:i,body:d},f=c._request("webpay",null,null,"POST",c._encode(h,null,!0));return f.then(function(a){return c._decode(null,a)})._thenRunCallbacks(e)},queryOrder:function(d,e){var f=c._request("pay/"+d,null,null,"GET",null);return f.then(function(a){return c._decode(null,a)})._thenRunCallbacks(e)}})}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob,h=c._;c.Cloud=c.Cloud||{},h.extend(c.Cloud,{run:function(e,a,d){var f=c._request("functions",e,null,"POST",c._encode(a,null,!0));return f.then(function(a){return c._decode(null,a).result})._thenRunCallbacks(d)}})}(this),function(a){a.Bmob=a.Bmob||{};var c=a.Bmob;c.Installation=c.Object.extend("_Installation"),c.Push=c.Push||{},c.Push.send=function(e,a){if(e.where&&(e.where=e.where.toJSON().where),e.push_time&&(e.push_time=e.push_time.toJSON()),e.expiration_time&&(e.expiration_time=e.expiration_time.toJSON()),e.expiration_time&&e.expiration_time_interval)throw"Both expiration_time and expiration_time_interval can't be set";var d=c._request("push",null,null,"POST",e);return d._thenRunCallbacks(a)}}(this);